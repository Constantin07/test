---

helmDefaults:
  verify: false
  wait: true
  timeout: 180
  historyMax: 5

repositories:
  - name: ingress-nginx
    url: https://kubernetes.github.io/ingress-nginx

releases:
  - name: nginx-ingress
    namespace: {{ requiredEnv "NAMESPACE" }}
    chart: ingress-nginx/ingress-nginx
    version: 4.1.1
    values:
      - controller:
          image:
            pullPolicy: Always
          config:
            add-headers: {{ requiredEnv "NAMESPACE" }}/{{ requiredEnv "HEADERS_CONFIGMAP_NAME" }}
            disable-ipv6: "true"
            enable-modsecurity: "true"
            enable-owasp-modsecurity-crs: "true"
            http-snippet: |
              more_clear_headers Server X-Powered-By;
            use-forwarded-headers: "true"
            compute-full-forwarded-for: "true"
          extraArgs:
            enable-ssl-passthrough: true
          dnsPolicy: ClusterFirstWithHostNet
          reportNodeInternalIp: true
          hostNetwork: true
          ingressClassResource:
            name: internal
            default: true
          publishService:
            enabled: false
          kind: DaemonSet
          minReadySeconds: 5
          service:
            type: NodePort
            nodePorts:
              http: 30000
              https: 30001
            externalTrafficPolicy: Local
          scope:
            enabled: false
          metrics:
            enabled: true
        podSecurityPolicy:
          enabled: true
