---

helmDefaults:
  verify: false
  wait: true
  timeout: 120
  recreatePods: true
  historyMax: 5

releases:
  - name: nginx-ingress
    namespace: {{ requiredEnv "NAMESPACE" }}
    chart: stable/nginx-ingress
    version: 1.31.0
    values:
      - controller:
          image:
            pullPolicy: Always
          hostNetwork: true
          dnsPolicy: ClusterFirstWithHostNet
          reportNodeInternalIp: true
          ingressClass: internal
          config:
            add-headers: {{ requiredEnv "NAMESPACE" }}/{{ requiredEnv "CONFIGMAP_NAME" }}
            enable-modsecurity: "true"
            enable-owasp-modsecurity-crs: "true"
            http-snippet: |
              more_clear_headers Server X-Powered-By;
            use-forwarded-headers: "true"
          kind: DaemonSet
          publishService:
            enabled: false
          service:
            type: NodePort
            nodePorts:
              http: 30000
              https: 30001
            externalTrafficPolicy: Local
          scope:
            enabled: false
        podSecurityPolicy:
          enabled: true
